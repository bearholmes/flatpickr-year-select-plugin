{"version":3,"file":"flatpickr-year-select-plugin.umd.js","sources":["../src/plugin.ts"],"sourcesContent":["import type { Instance as FlatpickrInstance } from 'flatpickr/dist/types/instance';\nimport type { Plugin } from 'flatpickr/dist/types/options';\n\n/**\n * Configuration options for the year dropdown plugin\n */\nexport interface YearDropdownPluginConfig {\n  /** Number of years to show before the current year (default: 3) */\n  start?: number;\n  /** Number of years to show after the current year (default: 3) */\n  end?: number;\n}\n\n/**\n * Extended flatpickr instance with year select container\n */\ninterface ExtendedInstance extends FlatpickrInstance {\n  yearSelectContainer?: HTMLElement;\n  _createElement: FlatpickrInstance['_createElement'];\n  parseDate: FlatpickrInstance['parseDate'];\n}\n\n/**\n * Creates a flatpickr plugin that replaces the default year input with a dropdown select\n *\n * @param pluginConfig - Configuration options for the year range\n * @returns A flatpickr plugin function\n *\n * @example\n * ```typescript\n * import flatpickr from 'flatpickr';\n * import yearSelectPlugin from 'flatpickr-year-select-plugin';\n * import 'flatpickr-year-select-plugin/dist/yearSelectPlugin.min.css';\n *\n * flatpickr(\"#myInput\", {\n *   plugins: [\n *     yearSelectPlugin({\n *       start: 5,  // Show 5 years before current\n *       end: 5     // Show 5 years after current\n *     })\n *   ]\n * });\n * ```\n */\nconst yearDropdownPlugin = function (pluginConfig?: YearDropdownPluginConfig): Plugin {\n  const baseConfig: YearDropdownPluginConfig = {\n    start: pluginConfig && pluginConfig.start !== undefined ? pluginConfig.start : 3,\n    end: pluginConfig && pluginConfig.end !== undefined ? pluginConfig.end : 3,\n  };\n\n  return function (fp: FlatpickrInstance) {\n    if (!fp) return {};\n\n    const extended = fp as ExtendedInstance;\n    const config: YearDropdownPluginConfig = { ...baseConfig };\n    const parseDateValue = (value: unknown): Date | undefined => {\n      if (!value) return undefined;\n      const parseSingle = (val: unknown): Date | undefined => {\n        if (!val) return undefined;\n        if (val instanceof Date) return isNaN(val.getTime()) ? undefined : val;\n        if (typeof val === 'string' || typeof val === 'number') {\n          const parsed = extended.parseDate ? extended.parseDate(val) : new Date(val);\n          return parsed && !isNaN(parsed.getTime()) ? parsed : undefined;\n        }\n        return undefined;\n      };\n\n      if (Array.isArray(value)) {\n        for (const entry of value) {\n          const parsed = parseSingle(entry);\n          if (parsed) return parsed;\n        }\n        return undefined;\n      }\n\n      return parseSingle(value);\n    };\n\n    const getYearBounds = () => {\n      const minDate = parseDateValue(extended.config.minDate);\n      const maxDate = parseDateValue(extended.config.maxDate);\n      const minYearRaw = minDate?.getFullYear();\n      const maxYearRaw = maxDate?.getFullYear();\n      const minYear =\n        minYearRaw !== undefined && maxYearRaw !== undefined\n          ? Math.min(minYearRaw, maxYearRaw)\n          : minYearRaw;\n      const maxYear =\n        minYearRaw !== undefined && maxYearRaw !== undefined\n          ? Math.max(minYearRaw, maxYearRaw)\n          : maxYearRaw;\n      return { minYear, maxYear };\n    };\n\n    const clampYear = (year: number) => {\n      const { minYear, maxYear } = getYearBounds();\n      if (minYear !== undefined && year < minYear) return minYear;\n      if (maxYear !== undefined && year > maxYear) return maxYear;\n      return year;\n    };\n    const getYearRange = (year: number) => {\n      const { minYear, maxYear } = getYearBounds();\n      const clampedYear = clampYear(year);\n      const rawStart = config.start !== undefined ? clampedYear - config.start : clampedYear;\n      const rawEnd = config.end !== undefined ? clampedYear + config.end : clampedYear;\n      const start = minYear !== undefined ? Math.max(rawStart, minYear) : rawStart;\n      const end = maxYear !== undefined ? Math.min(rawEnd, maxYear) : rawEnd;\n      return { clampedYear, start, end };\n    };\n\n    const resolveInitialYear = () => {\n      const selectedYear = fp.selectedDates?.[0]?.getFullYear();\n      const defaultDate = parseDateValue(fp.config.defaultDate);\n      const defaultYear =\n        defaultDate && !isNaN(defaultDate.getTime()) ? defaultDate.getFullYear() : undefined;\n\n      return clampYear(\n        extended.currentYear ?? selectedYear ?? defaultYear ?? new Date().getFullYear()\n      );\n    };\n    const initialYear = resolveInitialYear();\n\n    const yearWrapper = document.createElement('div');\n    yearWrapper.classList.add('flatpickr-current-year');\n    const yearDropdown = document.createElement('select');\n    yearDropdown.classList.add('flatpickr-monthDropdown-years');\n    yearDropdown.setAttribute('aria-label', 'Year');\n    yearDropdown.setAttribute('name', 'year');\n    let suppressNextYearChange = false;\n\n    const createSelectElement = function (year: number) {\n      yearDropdown.innerHTML = '';\n\n      const { clampedYear, start, end } = getYearRange(year);\n\n      for (let i = start; i <= end; i++) {\n        const option = document.createElement('option');\n        option.value = String(i);\n        option.text = String(i);\n        yearDropdown.appendChild(option);\n      }\n      yearDropdown.value = String(clampedYear);\n      return clampedYear;\n    };\n\n    extended.yearSelectContainer = extended._createElement('div', 'flatpickr-years', '');\n\n    createSelectElement(initialYear);\n\n    yearDropdown.addEventListener('change', function (evt) {\n      const target = evt.target as HTMLSelectElement;\n      if (!target) return;\n      const year = target.options[target.selectedIndex].value;\n\n      extended.changeYear(Number(year));\n      extended.redraw();\n    });\n\n    yearWrapper.append(yearDropdown);\n    if (extended.yearSelectContainer) {\n      extended.yearSelectContainer.append(yearWrapper);\n    }\n\n    return {\n      onReady: function onReady() {\n        if (!extended.monthNav || !extended.calendarContainer) {\n          console.warn('flatpickr-year-select-plugin: Required elements not found');\n          return;\n        }\n\n        const name = extended.monthNav.className;\n        const yearInputCollection = extended.calendarContainer.getElementsByClassName(name);\n        const el = yearInputCollection[0];\n        if (!el || !el.parentNode || !extended.yearSelectContainer) return;\n        el.parentNode.insertBefore(extended.yearSelectContainer, el.parentNode.firstChild);\n\n        const { start, end } = getYearRange(initialYear);\n\n        if (!extended.config.minDate) extended.set('minDate', `${start}-01-01`);\n        if (!extended.config.maxDate) extended.set('maxDate', `${end}-12-31`);\n      },\n      onOpen: function onOpen(\n        _selectedDates: Date[],\n        _dateStr: string,\n        instance: FlatpickrInstance\n      ) {\n        const clampedYear = createSelectElement(instance.currentYear);\n        if (clampedYear !== instance.currentYear) {\n          suppressNextYearChange = true;\n          extended.changeYear(clampedYear);\n          extended.redraw();\n          suppressNextYearChange = false;\n        }\n      },\n      onYearChange: function onYearChange(\n        _selectedDates: Date[],\n        _dateStr: string,\n        instance: FlatpickrInstance\n      ) {\n        if (suppressNextYearChange) {\n          suppressNextYearChange = false;\n          createSelectElement(instance.currentYear);\n          return;\n        }\n        const clampedYear = createSelectElement(instance.currentYear);\n        if (clampedYear !== instance.currentYear) {\n          suppressNextYearChange = true;\n          extended.changeYear(clampedYear);\n          extended.redraw();\n          suppressNextYearChange = false;\n        }\n      },\n    };\n  };\n};\n\nexport default yearDropdownPlugin;\n"],"names":["pluginConfig","baseConfig","fp","extended","config","parseDateValue","value","parseSingle","val","parsed","entry","getYearBounds","minDate","maxDate","minYearRaw","maxYearRaw","minYear","maxYear","clampYear","year","getYearRange","clampedYear","rawStart","rawEnd","start","end","initialYear","selectedYear","defaultDate","defaultYear","yearWrapper","yearDropdown","suppressNextYearChange","createSelectElement","i","option","evt","target","name","el","_selectedDates","_dateStr","instance"],"mappings":"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"}